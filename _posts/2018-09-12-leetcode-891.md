---
layout: post
title: Leetcode 891. Sum of Subsequence Widths 解題
---

[原題連結](https://leetcode.com/articles/sum-of-subsequence-widths/)

先看看題目原文：

> Given an array of integers `A`, consider all non-empty subsequences of `A`.
>
> For any sequence S, let the *width* of S be the difference between the maximum and minimum element of S.
> 
> Return the sum of the widths of all subsequences of A.
> As the answer may be very large, **return the answer modulo 10⁹ + 7**.

問題為輸入一個整數陣列 $A$，考慮他所有的非空子集合，並且定義其寬度 **(width)** 為該子集合中，最大值和最小值之差，本題所求為 $A$ 之所有非空子集的width總和。

### 例子
$A=[2,1,3]$，則A有下列之非空子集：

$[1],[2],[3],[1,2],[1,3],[2,3],[1,2,3]$ 

而其width之分別為 0, 0, 0, 1, 2, 1, 2 其之和為6。

------

## **解題**

拿到這題的第一個想法便是先sorting，因為本題為集合問題，又需要子集之最大最小值，做sorting之後我們能得到許多好處，並一網打盡某case所有的permutation。

接著分析width的本質，我們先令陣列各項為 $A_i,~\forall i\in\{1,2,3,...,n\}$，再令各項相鄰的差值為 $D_i$,如下： 
$$
D_{j}=A_{j+1}-A_{j},\quad\forall j\in \{1,2,3,...,n-1\}
$$

我們能使用$D_i$的和表示出，若$A$的的非空子集 $S$，最大值為$A_q$，最小值為$A_p$，$p,q\in\{1,2,3,...,n\}$，該子集合的width $w_{s}$可表示為：

$$
\phi \neq S\subset A , w_{S}=
\left\{ \begin{align*}
 \sum_{i=p}^{q} D_i &~,~& \left | S \right | \ge 2\\ 
 0 &~,~&\left | S \right |=1
\end{align*}\right.
$$

若$S$只有一個元素，其width為trivial的0。

### 三個元素

接著再回到三個元素的case來分析，先令$A=[A_{1},A_{2},A_{3}]$且已排序好：

![img](https://cdn-images-1.medium.com/max/800/1*Bqwa316koLu5_pfaowJQtQ.png){: .center-image }

考慮它所有子集的width值，再加總起來

![img](https://cdn-images-1.medium.com/max/800/1*UylP4nOX-VkaO3JTfhMMrA.png){: .center-image }

由結果發現它的總width值是可以寫成相鄰兩項差$D_i$的線性組合，並且有個特定的係數$\{3,3\}$，我們使用$C_i$來表示好了。



也就是說，$n=3$ 的case只要我們求得相鄰兩項差$D_i$，本題所求之答案 $W$ 即為
$$W=\sum^{n-1}_{i=1}C_{i}\cdot D_{i}$$

以上面$~A=[2,1,3]~$為例，$D_1=1,D_2=1$
則 $~W=C_1\cdot D_1+C_2\cdot D_2=3+3=6$

### 推廣

那是不是能推廣到更多元素的case呢，答案是肯定的。




我寫了一段小程式考慮$A$元素個數$~n=2,3,...,10$ 的所有非空子集，並記錄他們的width值是哪些$D_i$的和，最後統計總共各使用了多少個$D_i$，也就是上例乘在$D_i$之前的線性組合係數$C_i$。

而考慮每個子集的方法是：先假設$A$是increasing order，對每個元素$A_i$而言，它可能在這個子集或是不在這個子集，故子集總數為 $2^{n}$ 個，在去計算其width是那些$D_{i}$之和，在累加每個$D_{i}$的使用個數，所以此列舉方法時間為$O(n\cdot2^{n})$

而它結果如下：

```
n = 2  ,[ 1]
n = 3  ,[ 3, 3 ] 
n = 4  ,[ 7, 9, 7 ]  
n = 5  ,[ 15, 21, 21, 15 ] 
n = 6  ,[ 31, 45, 49, 45, 31 ] 
n = 7  ,[ 63, 93, 105, 105, 93, 63 ] 
n = 8  ,[ 127, 189, 217, 225, 217, 189, 127 ] 
n = 9  ,[ 255, 381, 441, 465, 465, 441, 381, 255 ] 
n = 10 ,[ 511, 765, 889, 945, 961, 945, 889, 765, 511 ]
```
$$
\begin{align*}
n=4 &~,&W&=C_1D_1+C_2D_2+C_3D_3 &=&~~7D_1+9 D_2+7D_3 \\
n=5 &~,&W&=C_1D_1+C_2D_2+C_3D_3+C_4D_4 &=&~~15D_1+21D_2+21D_3+15D_4
\end{align*}
$$
可以發現，這些係數具有一些性質，即便不同元素個數的case，它們的係數都是左右對稱的，而且由於每多一個元素就會多一個值，這些數字形成了一個三角形的形狀，可以發現它與巴斯卡三角形有點類似，而為了觀察規律，我們不免俗地把它排成比較好看的三角形，方便我們觀察：

![img](https://cdn-images-1.medium.com/max/800/1*ZKGtjp1JgTdakVpvFYNMaQ.png){: .center-image }


為了解說方便，我們令 $c(n,i)$ 為元素個數為$n$時，其$D_{i}$項的係數$C_{i}$。
也就是三角形的第一列為 $~c(2,1)=1$，第二列為$~c(3,1)=3, c(3,2)=3$。

開始對三角形做一些觀察：

![img](https://cdn-images-1.medium.com/max/800/1*zgx_chjP5kcpT6A6uE-aHg.png){: .center-image }

首先觀察邊的地方 *(圖中塗黃色處)* ，從頂點延伸到兩邊的數列，正好是以 $2^{x}-1$的形式形成的，我們把這個數列各項令為$B_n$好了，而由於第一列是 $n=2$ 的case，我們再對它做點調整，如下：
$$B_n=2^{n-1}-1 \quad,n\ge2$$
eg.$ B_2=1, B_3=3$

則我們可以確定每個case的$C_1$項了，也就是 $c(n,1)=B_n=2^{n-1}-1$

![img](https://cdn-images-1.medium.com/max/800/1*43H04Uj20SqpkFvs1FawZQ.png){: .center-image }

再來觀察不在黃邊的數，以圖中的**93**與**441**為例，我們可以發現，所有不在黃邊上的數，都恰好是由其向兩側斜向與黃邊的交點的兩數，相乘所得的乘積$~(93=31\cdot3,~~441=63\cdot7)~$

有了上面的觀察，我們可以把係數改寫成：
$$c(n,i)=B_{n-i+1}\cdot B_{i+1}$$係數可以用$B_i$表示出來了，讓我們試試一些例子。

以 $n=6$ 為例

$$
\begin{align*}
c(6,1)&=B_{6}\cdot B_{2}=31\cdot
1&=&~31\\
c(6,2)&=B_{5}\cdot B_{3}=15\cdot3&=&~45\\
c(6,3)&=B_{4}\cdot B_{4}=7\cdot7&=&~49\\
c(6,4)&=B_{3}\cdot B_{5}=3\cdot15&=&~45\\
c(6,5)&=B_{2}\cdot B_{6}=1\cdot31&=&~31
\end{align*}
$$
